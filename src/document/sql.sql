-- 휴지통 비우기 --

PURGE RECYCLEBIN;

-- 회원 --

CREATE TABLE MY_MEMBER(
	M_ID	VARCHAR2(20),
	M_PW	VARCHAR2(40) NOT NULL,
	M_NICK	VARCHAR2(40) NOT NULL,
	M_AGE	NUMBER(3) NOT NULL,
	M_EMAIL	VARCHAR2(100) NOT NULL,
	CONSTRAINT MY_MEMBER_PK PRIMARY KEY(M_ID),
	CONSTRAINT MY_MEMBER_UK_EMAIL UNIQUE(M_EMAIL)
);

SELECT * FROM MY_MEMBER;

DROP TABLE MY_MEMBER
CASCADE CONSTRAINTS;


-- /////////////////////////////////////////// --

-- 게시판 --

SELECT * FROM MY_BOARD ORDER BY B_GROUP DESC, B_DEPTH ASC, B_STEP ASC, B_SEQ DESC;

SELECT NVL2(MAX(B_STEP), MAX(B_STEP)+1, 0) FROM MY_BOARD 
WHERE B_GROUP = (SELECT B_GROUP FROM MY_BOARD WHERE B_SEQ = 1)
AND B_DEPTH = (SELECT B_DEPTH FROM MY_BOARD WHERE B_SEQ = 1) + 1;

SELECT MAX(B_STEP) FROM MY_BOARD;

SELECT MAX(B_STEP) FROM MY_BOARD WHERE B_GROUP = (SELECT B_GROUP FROM MY_BOARD WHERE B_SEQ = 1);

SELECT MAX(B_STEP) FROM MY_BOARD WHERE B_GROUP = 1 AND B_DEPTH = 1;

SELECT * FROM MY_BOARD
WHERE B_DEL = 0
AND B_TITLE LIKE '%안녕%'
OR B_CONTENT LIKE '%안녕%';

SELECT REPLACE(B_CONTENT, CHR(10), '<br/>') FROM MY_BOARD;

INSERT INTO MY_BOARD
VALUES(SEQ_MY_BOARD.NEXTVAL,
(SELECT B_GROUP FROM MY_BOARD WHERE B_SEQ = 1),
(SELECT B_DEPTH FROM MY_BOARD WHERE B_SEQ = 1)+1,
(SELECT NVL((SELECT B_STEP FROM MY_BOARD WHERE B_GROUP = 1 AND B_DEPTH = 1), 0)+1 FROM MY_BOARD),
1, 'test', '2', '답글', '답글이당', null, 0, SYSDATE, 0, 0, 0);
--(SELECT B_STEP FROM MY_BOARD WHERE B_SEQ = 3));

DELETE FROM MY_BOARD
WHERE B_SEQ = 2;

CREATE TABLE MY_BOARD(
	B_SEQ			NUMBER,
	B_GROUP			NUMBER(2) NOT NULL,
	B_DEPTH			NUMBER(2) NOT NULL,
	B_STEP			NUMBER(2) NOT NULL,
	B_PARENT_SEQ	NUMBER,
	B_PARENT_DEL	NUMBER(1) NOT NULL,
	B_ID			VARCHAR2(20) NOT NULL,
	B_PW			NUMBER(4) NOT NULL,
	B_TITLE			VARCHAR2(100) NOT NULL,
	B_CONTENT		NCLOB,
	B_FILENAME		VARCHAR2(40),
	B_READCOUNT		NUMBER NOT NULL,
	B_WRITEDATE		DATE NOT NULL,
	B_NOTICE		NUMBER(1) NOT NULL,
	B_DEL			NUMBER(1) NOT NULL,
	B_COMMENT_SEQ	NUMBER,
	CONSTRAINT MY_BOARD_PK PRIMARY KEY(B_SEQ)
--	CONSTRAINT MY_BOARD_COMMENT_FK FOREIGN KEY(B_COMMENT_SEQ)
);

CREATE SEQUENCE SEQ_MY_BOARD
START WITH 1 INCREMENT BY 1;

DROP TABLE MY_BOARD
CASCADE CONSTRAINTS;

DROP SEQUENCE SEQ_MY_BOARD;

INSERT INTO MY_BOARD
VALUES(SEQ_MY_BOARD.NEXTVAL, SEQ_MY_BOARD.CURRVAL, 0, 0, 0, 0, 'test', 2, '우아아아', '캬캬', NULL, 0, SYSDATE-1, 0, 0, 0);